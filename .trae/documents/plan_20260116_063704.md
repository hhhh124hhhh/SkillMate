# 实现智谱模型API密钥配置支持

## 问题分析

通过分析项目代码和运行状态，发现以下关键问题：

1. **API密钥配置单一**：`ConfigStore.getApiKey()` 方法只从 `ANTHROPIC_API_KEY` 环境变量获取密钥，没有为智谱模型提供单独的密钥配置

2. **模型切换后密钥不匹配**：用户切换到智谱模型后，需要使用智谱提供的API密钥，而不是Anthropic的密钥

3. **配置系统需要扩展**：当前配置系统没有区分不同模型类型的API密钥

## 解决方案

### 1. 扩展配置接口

**修改 `ConfigStore.ts`**：
- 在 `AppConfig` 接口中添加 `zhipuApiKey` 字段
- 在 `defaults` 对象中添加默认空值
- 添加 `getZhipuApiKey()` 和 `setZhipuApiKey()` 方法
- 修改 `getApiKey()` 方法，根据当前模型类型返回对应的密钥

### 2. 更新环境变量配置

**修改 `.env` 和 `.env.example`**：
- 添加 `ZHIPU_API_KEY` 环境变量配置
- 提供清晰的配置说明

### 3. 更新主进程初始化

**修改 `main.ts`**：
- 确保智谱API密钥被正确注入到环境变量
- 根据选择的模型类型，使用对应的API密钥初始化AgentRuntime

### 4. 测试验证

- 配置智谱API密钥
- 切换到智谱模型
- 测试API调用是否成功
- 验证Anthropic模型仍然可以正常使用

## 实现步骤

1. **修改 `ConfigStore.ts`** - 扩展配置接口和方法
2. **更新 `.env` 和 `.env.example`** - 添加智谱API密钥配置
3. **修改 `main.ts`** - 确保正确的密钥注入
4. **测试验证** - 验证两种模型都能正常工作

这样修改后，项目就能根据选择的模型类型自动使用对应的API密钥，实现无缝切换。