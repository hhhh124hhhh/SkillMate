---
name: requesting-code-review
description: |
  请求代码审查 - 当完成主要项目步骤、实施功能或合并代码之前使用此技能。
  验证工作是否符合原始计划和编码标准，识别潜在问题。当用户需要：代码审查、质量检查、验证实现时触发此技能。
---

# 请求代码审查

## 概述

代码审查确保实现质量、发现潜在问题并保持代码标准。

**核心原则**：请求代码审查以确保工作符合计划和最佳实践。

**开始时声明**："我正在使用 requesting-code-review 技能审查此实现。"

## 何时使用

**总是使用**，在以下情况：
- 完成主要项目步骤后
- 实施功能后
- 合并代码到主分支前
- 完成复杂的 bug 修复后
- 重构代码后

**特别在以下情况下使用**：
- 实现涉及多个文件
- 代码影响关键路径
- 修改性能或安全相关代码
- 需要验证设计决策

## 审查清单

### 1. 功能正确性

**检查**：
- [ ] 实现是否符合原始计划？
- [ ] 所有功能需求是否满足？
- [ ] 边界情况是否正确处理？
- [ ] 错误处理是否完善？

**问题**：
- 实现是否遗漏了计划中的任何要求？
- 是否有未处理的边缘情况？

### 2. 代码质量

**检查**：
- [ ] 代码是否清晰易读？
- [ ] 变量和函数命名是否描述性？
- [ ] 是否遵循项目代码风格？
- [ ] 是否有注释解释复杂逻辑？

**问题**：
- 代码是否过度复杂？
- 是否有重复代码可以提取？
- 是否有硬编码值应该参数化？

### 3. 测试覆盖

**检查**：
- [ ] 是否有足够的单元测试？
- [ ] 测试是否覆盖正常路径？
- [ ] 测试是否覆盖边缘情况？
- [ ] 测试是否覆盖错误情况？

**问题**：
- 测试是否真实测试行为而非实现？
- 是否有缺失的测试场景？

### 4. 性能考虑

**检查**：
- [ ] 是否有明显的性能问题？
- [ ] 是否有不必要的数据库查询？
- [ ] 是否有内存泄漏风险？
- [ ] 算法复杂度是否合理？

**问题**：
- 是否可以优化性能？
- 是否添加了适当的缓存？

### 5. 安全性

**检查**：
- [ ] 用户输入是否正确验证？
- [ ] 是否防止注入攻击（SQL、XSS、命令注入）？
- [ ] 敏感数据是否正确处理？
- [ ] 是否遵循最小权限原则？

**问题**：
- 是否有安全漏洞？
- 是否正确处理身份验证和授权？

### 6. 文档

**检查**：
- [ ] 是否更新了相关文档？
- [ ] API 变更是否记录？
- [ ] 配置变更是否说明？
- [ ] README 是否更新？

**问题**：
- 文档是否完整且准确？
- 是否有使用示例？

## 审查流程

### 步骤 1：自我审查

在请求审查前，先自我审查：

```bash
# 运行测试
npm test / pytest / cargo test

# 运行 linter
npm run lint / flake8 / clippy

# 检查构建
npm run build / cargo build

# 查看更改
git diff
git diff --staged
```

### 步骤 2：准备审查请求

提供以下信息：

**上下文**：
- 简要描述实现的内容
- 链接到相关的计划或 issue
- 说明为什么需要这个更改

**关键文件**：
- 列出修改的主要文件
- 标注需要特别关注的文件

**测试**：
- 说明如何测试这些更改
- 提供测试环境或步骤

### 步骤 3：提交审查请求

创建 Pull Request 或提交代码审查请求：

```bash
# 推送分支
git push -u origin feature-xyz

# 创建 PR
gh pr create --title "feat: implement XYZ feature" --body "审查请求..."
```

**PR 模板**：
```markdown
## 概述
简要描述实现的功能。

## 更改
- 主要更改 1
- 主要更改 2
- 主要更改 3

## 测试
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试通过

## 审查重点
请特别关注：
- 性能影响
- 安全性考虑
- 代码可维护性

## 相关链接
- 计划文档：链接
- Issue：#123
```

### 步骤 4：响应反馈

**处理审查意见**：
1. **理解**：确保理解每条意见
2. **讨论**：如有疑问，提出问题
3. **修改**：实施建议的更改
4. **验证**：确保修改不破坏现有功能
5. **更新**：标记已处理的意见

## 审查原则

### 建设性反馈

**给出反馈时**：
- 具体明确（不要模糊）
- 解释为什么（不要只说"改这个"）
- 提供改进建议（不要只指出问题）
- 认可好的部分（不要只关注负面）

**示例**：
```
❌ "这个函数太复杂了"
✅ "这个函数有 50 行，包含多个嵌套循环。建议拆分成更小的函数，
   每个函数负责一个具体任务。这样可以提高可读性和可测试性。"
```

### 接受反馈

**接收反馈时**：
- 保持开放心态
- 提问澄清不理解的地方
- 解释设计决策（不要辩解）
- 感谢审查者的时间

## 常见问题

### 过度设计

**症状**：
- 实现了计划中不要求的功能
- 创建了不必要的抽象
- 过度优化

**建议**：
- 坚持计划中的要求
- 遵循 YAGNI 原则
- 保持简单

### 缺少测试

**症状**：
- 新代码没有测试
- 测试覆盖不足
- 测试质量低

**建议**：
- 为新功能添加测试
- 使用 TDD 方法
- 测试行为而非实现

### 文档过时

**症状**：
- API 文档未更新
- README 过时
- 注释不准确

**建议**：
- 更新所有相关文档
- 保持文档与代码同步
- 提供使用示例

## 与其他技能的集成

**工作流程**：
1. **brainstorming** - 设计功能
2. **writing-plans** - 编写实施计划
3. **executing-plans** - 实施功能
4. **requesting-code-review** - 审查实施 ⬅️ 这里
5. **receiving-code-review** - 处理审查反馈
6. **finishing-a-development-branch** - 完成开发分支

## 快速参考

| 审查领域 | 关键检查 |
|---------|---------|
| **功能** | 符合计划、边界情况、错误处理 |
| **质量** | 可读性、命名、风格、注释 |
| **测试** | 覆盖率、正常/边缘/错误路径 |
| **性能** | 查询优化、内存、算法复杂度 |
| **安全** | 输入验证、注入防护、敏感数据 |
| **文档** | API 更新、配置说明、README |

## 依赖要求

- 无需特殊依赖
- 需要代码审查系统（GitHub PR、GitLab MR 等）

## 示例场景

### 场景 1：完成功能实施

```bash
# 1. 自我审查
npm run lint
npm test
git diff

# 2. 创建 PR
git push origin feature-user-auth
gh pr create --title "feat: user authentication" --body "..."

# 3. 请求审查
# @team 请审查此 PR
```

### 场景 2：修复 Bug

```markdown
## Bug 修复审查

### 问题
用户无法登录（#123）

### 根本原因
密码验证逻辑错误，始终返回 false

### 修复
修正验证逻辑，添加单元测试

### 测试
- [ ] 新测试通过
- [ ] 回归测试通过
- [ ] 手动测试通过

### 请关注
- 验证逻辑是否正确
- 测试是否充分
```

## 关键原则

- **提前审查**：不要等到最后一刻
- **开放心态**：接受建设性反馈
- **具体明确**：提供清晰的上下文
- **感谢审查者**：他们的时间很有价值
- **跟进反馈**：及时响应和修改
